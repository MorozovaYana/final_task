
‚úàÔ∏è Flask + PostgreSQL Airline Demo

–ë–ª–æ–≥ + –ê–≤—ñ–∞—Ü—ñ–π–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö (Flights, Bookings, Logs)

–¶–µ–π –ø—Ä–æ—î–∫—Ç ‚Äî –Ω–∞–≤—á–∞–ª—å–Ω–∞ Flask-–∞–ø–ª—ñ–∫–∞—Ü—ñ—è, —è–∫–∞ –ø–æ—î–¥–Ω—É—î:

* –±–ª–æ–≥-–ø–ª–∞—Ç—Ñ–æ—Ä–º—É (—Ç–∞–±–ª–∏—Ü—è `entries`);
* –∞–≤—ñ–∞—Ü—ñ–π–Ω–∏–π –º–æ–¥—É–ª—å (—Ä–µ–π—Å–∏, –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è, –ª–æ–≥—É–≤–∞–Ω–Ω—è);
* –ø—Ä–∏–∫–ª–∞–¥–∏ **—Ñ—É–Ω–∫—Ü—ñ–π**, **—Ç—Ä–∏–≥–µ—Ä—ñ–≤** —Ç–∞ **–ø—Ä–æ—Ü–µ–¥—É—Ä** —É PostgreSQL;
* HTML/CSS —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å;
* Flask –º–∞—Ä—à—Ä—É—Ç–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –¥–∞–Ω–∏–º–∏ —Ç–∞ –≤–∏–∫–ª–∏–∫—É SQL –ª–æ–≥—ñ–∫–∏.

---

# üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
project/
‚îÇ
‚îú‚îÄ‚îÄ main.py                 # Flask —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ schema.sql              # SQL-—Å—Ö–µ–º–∞ –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—å
‚îú‚îÄ‚îÄ populate.sql            # –¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ
‚îÇ
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ flights.html
‚îÇ   ‚îú‚îÄ‚îÄ logs.html
‚îÇ   ‚îú‚îÄ‚îÄ booking_result.html
‚îÇ   ‚îî‚îÄ‚îÄ browse.html
‚îÇ
‚îî‚îÄ‚îÄ static/
    ‚îî‚îÄ‚îÄ style.css
```

---

# üõ†Ô∏è –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

* **Python 3**
* **Flask**
* **PostgreSQL**
* **psycopg2**
* **HTML + CSS**
* **PL/pgSQL** (—Ñ—É–Ω–∫—Ü—ñ—ó, –ø—Ä–æ—Ü–µ–¥—É—Ä–∏, —Ç—Ä–∏–≥–µ—Ä–∏)

---

# üìå –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É

## 1. üìñ –ë–ª–æ–≥ (—Ç–∞–±–ª–∏—Ü—è `entries`)

* –ü–µ—Ä–µ–≥–ª—è–¥ –∑–∞–ø–∏—Å—ñ–≤
* –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö (`populate.sql`)
* –í–∏–≤–µ–¥–µ–Ω–Ω—è —É –≤–∏–≥–ª—è–¥—ñ HTML –∞–±–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –¥–∞–º–ø—É

## 2. ‚úàÔ∏è –ê–≤—ñ–∞—Ü—ñ–π–Ω–∏–π –º–æ–¥—É–ª—å

### –¢–∞–±–ª–∏—Ü—ñ:

| –¢–∞–±–ª–∏—Ü—è      | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                      |
| ------------ | -------------------------------- |
| **flights**  | –†–µ–π—Å–∏, –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –º—ñ—Å—Ü—å |
| **bookings** | –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –ø–∞—Å–∞–∂–∏—Ä—ñ–≤             |
| **logs**     | –ñ—É—Ä–Ω–∞–ª –≤—Å—ñ—Ö –ø–æ–¥—ñ–π —ñ –¥—ñ–π          |

---

# üß© PostgreSQL —Ñ—É–Ω–∫—Ü—ñ—ó, —Ç—Ä–∏–≥–µ—Ä–∏ —Ç–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏

–ù–∏–∂—á–µ ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∏–π —Ä–æ–∑–±—ñ—Ä *–∫–æ–∂–Ω–æ—ó* —Ñ—É–Ω–∫—Ü—ñ—ó, —Ç—Ä–∏–≥–µ—Ä–∞ —Ç–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏, –∑ –ø–æ—è—Å–Ω–µ–Ω–Ω—è–º **–∫–æ–∂–Ω–æ–≥–æ —Ä—è–¥–∫–∞**, –∞ —Ç–∞–∫–æ–∂ **–ø—Ä–∏–∫–ª–∞–¥–∞–º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**.

---

# üìò 1. FUNCTION `log_event(msg TEXT)`

### ‚úî –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:

–ó–∞–ø–∏—Å—É—î –±—É–¥—å-—è–∫–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ —Ç–∞–±–ª–∏—Ü—é `logs`.

### üìÑ –ö–æ–¥ + –ø–æ—è—Å–Ω–µ–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ —Ä—è–¥–∫–∞:

```sql
CREATE OR REPLACE FUNCTION log_event(msg TEXT)
RETURNS VOID AS $$
BEGIN
    INSERT INTO logs(log_message) VALUES (msg);
END;
$$ LANGUAGE plpgsql;
```

üîç **–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

| –†—è–¥–æ–∫                        | –©–æ —Ä–æ–±–∏—Ç—å                          |
| ---------------------------- | ---------------------------------- |
| `CREATE OR REPLACE FUNCTION` | –°—Ç–≤–æ—Ä—é—î –∞–±–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î —Ñ—É–Ω–∫—Ü—ñ—é    |
| `log_event(msg TEXT)`        | –§—É–Ω–∫—Ü—ñ—è –ø—Ä–∏–π–º–∞—î 1 –ø–∞—Ä–∞–º–µ—Ç—Ä ‚Äî —Ç–µ–∫—Å—Ç |
| `RETURNS VOID`               | –ù—ñ—á–æ–≥–æ –Ω–µ –ø–æ–≤–µ—Ä—Ç–∞—î                 |
| `INSERT INTO logs`           | –î–æ–¥–∞—î –Ω–æ–≤–∏–π –∑–∞–ø–∏—Å —É —Ç–∞–±–ª–∏—Ü—é `logs` |
| `VALUES (msg)`               | –í—Å—Ç–∞–≤–ª—è—î —Ç–µ–∫—Å—Ç –ø–æ–¥—ñ—ó               |
| `LANGUAGE plpgsql`           | –§—É–Ω–∫—Ü—ñ—è –Ω–∞–ø–∏—Å–∞–Ω–∞ –Ω–∞ –º–æ–≤—ñ PL/pgSQL  |

### ‚ñ∂ –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

```sql
SELECT log_event('System started');
```

---

# üìò 2. TRIGGER FUNCTION `booking_created()`

### ‚úî –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:

–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î –∑–∞–ø–∏—Å —É `logs`, –∫–æ–ª–∏ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è.

### üìÑ –ö–æ–¥ + –ø–æ—è—Å–Ω–µ–Ω–Ω—è:

```sql
CREATE OR REPLACE FUNCTION booking_created()
RETURNS TRIGGER AS $$
BEGIN
    PERFORM log_event('New booking for passenger ' || NEW.passenger_name);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

üîç **–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

| –†—è–¥–æ–∫                    | –©–æ —Ä–æ–±–∏—Ç—å                                 |
| ------------------------ | ----------------------------------------- |
| `RETURNS TRIGGER`        | –¶–µ –Ω–µ –∑–≤–∏—á–∞–π–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è ‚Äî –∞ —Ç—Ä–∏–≥–µ—Ä-—Ñ—É–Ω–∫—Ü—ñ—è |
| `NEW.passenger_name`     | –î–∞–Ω—ñ –Ω–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –≤—Å—Ç–∞–≤–∫–∏                |
| `PERFORM log_event(...)` | –í–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó (–±–µ–∑ SELECT)               |
| `RETURN NEW`             | –ü–æ–≤–µ—Ä—Ç–∞—î –Ω–æ–≤–∏–π —Ä—è–¥–æ–∫ insert'—É             |

### –¶–µ–π –∫–æ–¥ *–Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –≤—Ä—É—á–Ω—É* ‚Äî –π–æ–≥–æ –≤–∏–∫–ª–∏–∫–∞—î —Ç—Ä–∏–≥–µ—Ä.

---

# üìò 3. TRIGGER `trg_booking_created`

### ‚úî –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:

–ó–∞–ø—É—Å–∫–∞—î —Ç—Ä–∏–≥–µ—Ä-—Ñ—É–Ω–∫—Ü—ñ—é –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ –Ω–æ–≤–æ–≥–æ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è.

### üìÑ –ö–æ–¥ + –ø–æ—è—Å–Ω–µ–Ω–Ω—è:

```sql
CREATE TRIGGER trg_booking_created
AFTER INSERT ON bookings
FOR EACH ROW
EXECUTE FUNCTION booking_created();
```

üîç **–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

| –†—è–¥–æ–∫                                | –û–ø–∏—Å                                     |
| ------------------------------------ | ---------------------------------------- |
| `AFTER INSERT`                       | –¢—Ä–∏–≥–µ—Ä –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ |
| `ON bookings`                        | –¢–∞–±–ª–∏—Ü—è, –Ω–∞ —è–∫—ñ–π –≤—ñ–Ω –ø—Ä–∞—Ü—é—î              |
| `FOR EACH ROW`                       | –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è      |
| `EXECUTE FUNCTION booking_created()` | –í–∏–∫–ª–∏–∫–∞—î –Ω–∞—à—É —Ç—Ä–∏–≥–µ—Ä-—Ñ—É–Ω–∫—Ü—ñ—é             |

### ‚ñ∂ –ü—Ä–∏–∫–ª–∞–¥ —Ä–æ–±–æ—Ç–∏:

```sql
INSERT INTO bookings(passenger_name, flight_id)
VALUES ('Yana', 2);
```

–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ —É `logs` –∑‚Äô—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å:

```
New booking for passenger Yana
```

---

# üìò 4. PROCEDURE `make_booking(p_passenger, p_flight_id)`

### ‚úî –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:

–°—Ç–≤–æ—Ä—é—î –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è **–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –º—ñ—Å—Ü—å**, –æ–Ω–æ–≤–ª—é—î —Ç–∞–±–ª–∏—Ü—é —Ä–µ–π—Å—ñ–≤ —ñ –∑–∞–ø–∏—Å—É—î –ª–æ–≥.

### üìÑ –ö–æ–¥ + –¥–µ—Ç–∞–ª—å–Ω–∏–π —Ä–æ–∑–±—ñ—Ä:

```sql
CREATE OR REPLACE PROCEDURE make_booking(p_passenger VARCHAR, p_flight_id INT)
LANGUAGE plpgsql
AS $$
DECLARE
    seats INT;
BEGIN
    SELECT available_seats INTO seats FROM flights WHERE id = p_flight_id;

    IF seats <= 0 THEN
        RAISE EXCEPTION 'No available seats!';
    END IF;

    INSERT INTO bookings(passenger_name, flight_id)
    VALUES (p_passenger, p_flight_id);

    UPDATE flights
    SET available_seats = available_seats - 1
    WHERE id = p_flight_id;

    PERFORM log_event('Procedure booking created for ' || p_passenger);
END;
$$;
```

üîç **–ü–æ—è—Å–Ω–µ–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –±–ª–æ–∫—É:**

### üî∏ `DECLARE`

–û–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö.

```
seats INT;
```

### üî∏ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≤—ñ–ª—å–Ω–∏—Ö –º—ñ—Å—Ü—å:

```
SELECT available_seats INTO seats
FROM flights
WHERE id = p_flight_id;
```

### üî∏ –Ø–∫—â–æ –º—ñ—Å—Ü—å –Ω–µ–º–∞ ‚Äî –∑—É–ø–∏–Ω–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:

```
IF seats <= 0 THEN
    RAISE EXCEPTION 'No available seats!';
END IF;
```

### üî∏ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è:

```
INSERT INTO bookings(passenger_name, flight_id)
VALUES (p_passenger, p_flight_id);
```

### üî∏ –ó–º–µ–Ω—à–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –º—ñ—Å—Ü—å:

```
UPDATE flights
SET available_seats = available_seats - 1
WHERE id = p_flight_id;
```

### üî∏ –ó–∞–ø–∏—Å —É –ª–æ–≥:

```
PERFORM log_event('Procedure booking created for ' || p_passenger);
```

---

# ‚ñ∂ –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∏:

### –£ PostgreSQL:

```sql
CALL make_booking('Yana Morozova', 3);
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

* –£ —Ç–∞–±–ª–∏—Ü—ñ **bookings** –∑ º—è–≤–∏—Ç—å—Å—è –Ω–æ–≤–µ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
* –£ —Ç–∞–±–ª–∏—Ü—ñ **flights** –¥–æ—Å—Ç—É–ø–Ω—ñ –º—ñ—Å—Ü—è –∑–º–µ–Ω—à–∞—Ç—å—Å—è –Ω–∞ 1
* –£ —Ç–∞–±–ª–∏—Ü—ñ **logs** –∑ º—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å:

```
Procedure booking created for Yana Morozova
```

---

# üåê Flask —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏

| URL        | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                      |
| ---------- | -------------------------------- |
| `/`        | –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ + –±–ª–æ–≥          |
| `/flights` | –ü–µ—Ä–µ–≥–ª—è–¥ —Å–ø–∏—Å–∫—É –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Ä–µ–π—Å—ñ–≤ |
| `/book`    | –§–æ—Ä–º–∞ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è                 |
| `/logs`    | –ü–µ—Ä–µ–≥–ª—è–¥ —Ç–∞–±–ª–∏—Ü—ñ –ª–æ–≥—ñ–≤           |

---

# ‚ñ∂ –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —á–µ—Ä–µ–∑ –≤–µ–±

1. –í—ñ–¥–∫—Ä–∏–π —Å—Ç–æ—Ä—ñ–Ω–∫—É **/flights**
2. –û–±–µ—Ä–∏ —Ä–µ–π—Å
3. –í–≤–µ–¥–∏ —ñ–º'—è –ø–∞—Å–∞–∂–∏—Ä–∞
4. –ù–∞—Ç–∏—Å–Ω–∏ **Book**
5. Flask –≤–∏–∫–ª–∏–∫–∞—î `CALL make_booking(...)`
6. –Ø–∫—â–æ –º—ñ—Å—Ü—å –Ω–µ–º–∞ ‚Üí HTML-—Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø–æ–∫–∞–∂–µ –ø–æ–º–∏–ª–∫—É
7. –Ø–∫—â–æ –≤—Å–µ –æ–∫ ‚Üí –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —Å—Ç–≤–æ—Ä–∏—Ç—å—Å—è, –ª–æ–≥ –∑–∞–ø–∏—à–µ—Ç—å—Å—è


–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–µ–∫—Ç—É:
![Flights Page](images/flights.png)

![Logs Page](images/logs.png)

![Booking Form](images/book.png)


